<!DOCTYPE html>
<html>
<head>
    <title>Story Loader</title>
    <style>
        body { font-family: sans-serif; background: #fafafa; text-align: center; padding: 50px; }
        input { padding: 10px; width: 250px; border-radius: 5px; border: 1px solid #ddd; }
        button { padding: 10px 20px; background: #e1306c; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 30px; }
        .card img, .card video { width: 100%; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .download-btn { display: block; margin-top: 10px; text-decoration: none; color: #0095f6; font-weight: bold; }
    </style>
</head>
<body>

    <h1>IG Story Loader</h1>
    <input type="text" id="username" placeholder="Enter IG Username (e.g. nasa)">
    <button onclick="loadStories()">Load Stories</button>
    <p style="font-size: 12px; color: #666; margin-top: 10px;">
        Note: Instagram requires authentication to view stories. Set IG_USERNAME and IG_PASSWORD environment variables on the server for authenticated access.
    </p>

    <div id="grid"></div>

    <script>
        // Detect if running on Vercel or locally
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000/fetch-stories'
            : '/api/fetch-stories';

        async function loadStories() {
            const username = document.getElementById('username').value;
            if (!username) {
                alert('Please enter a username');
                return;
            }
            
            const grid = document.getElementById('grid');
            grid.innerHTML = "Loading...";

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username })
            });

            const data = await response.json();
            grid.innerHTML = "";

            if (data.success) {
                data.media.forEach(url => {
                    const div = document.createElement('div');
                    div.className = 'card';
                    
                    // Check if it's a video or image
                    const isVideo = url.includes('.mp4');
                    const element = isVideo ? `<video src="${url}" controls>` : `<img src="${url}">`;
                    
                    div.innerHTML = `
                        ${element}
                        <a href="${url}" target="_blank" class="download-btn">Open Full Res</a>
                    `;
                    grid.appendChild(div);
                });
            } else {
                grid.innerHTML = "Error: " + data.message;
            }
        }
    </script>
</body>
</html>

